---
title: |
  | \vspace{0.3cm} \Huge \singlespacing \textbf{Economic Data 2023 - Labs}  \vspace{0.28cm}
  | \vspace{0.3cm} \large Week 5 \vspace{0.3cm}
indent: true
output:
  pdf_document:
    number_sections: true
    fig_caption: true
    citation_package: natbib 
    # keep_tex: true
citecolor: blue
linkcolor: blue
bibliography: library.bib
biblio-style: apsr
link-citations: true
fontsize: 11pt
# geometry: margin=3cm
# geometry: margin=2.4cm
geometry: margin=2.45cm
# fontsize: medium
linestretch: 2.5
header-includes:
   - \usepackage{setspace}\setstretch{2.9}
   - \usepackage{caption}
   - \captionsetup[figure]{font=small}
   - \usepackage[font={scriptsize,it}, labelfont={bf}]{caption}
   - \usepackage{threeparttable}
   - \usepackage{booktabs}
   - \usepackage{mathtools}
   - \pagenumbering{gobble}
   - \usepackage{setspace}
   - \usepackage{amsmath}
   - \usepackage{lmodern}
   - \usepackage{bbm}
   - \usepackage{lscape}
   - \newcommand{\blandscape}{\begin{landscape}}
   - \newcommand{\elandscape}{\end{landscape}}
   - \usepackage{boldline}
   - \usepackage{pdfpages}
   - \usepackage{color}
   - \usepackage{xcolor}
   - \colorlet{Blue}{blue}
   - \usepackage{enumitem}
   - \usepackage{romannum}
   - \usepackage{siunitx}
   - \usepackage{gensymb}
   - \usepackage[osf]{mathpazo}
   - \usepackage{graphicx}
   - \newcommand{\indep}{\rotatebox[origin=c]{90}{$\models$}}
   - \newtheorem{theorem}{Definition}
   - \usepackage{indentfirst}
   - \usepackage{pgf,tikz}
   - \usetikzlibrary{shapes}
   - \usepackage{bm}
   - \usepackage{dirtytalk}
   - \setlength{\bibsep}{3pt}
editor_options:
  chunk_output_type: console
---

\onehalfspacing
\pagenumbering{arabic}



# Part 1

In this exercise we will construct a scatter plot of life satisfaction and GDP per capita using R and data from Eurostat. 

- Open an R script and save it on your computer as \verb|life_satisfaction.R|.

- Go to https://ec.europa.eu/eurostat/en/ and download data on \say{Overall life satisfaction} for the years 2013, 2018, and 2021 for as many countries as possible (you donâ€™t have to select a specific sex and education) including the country you are assigned to. Download the data in csv format (you might have to unzip the file). 

- From the same website, download data on GDP per capita in constant prices for 2013, 2018, and 2021 and for the same countries as the life satisfaction data. Download the data in csv format (you might have to unzip the file). 

- Load and clean the data on life satisfaction as \texttt{life\_sat} (remove missing values, rename variables to meaningful and managable names, select the relevant variables). [Useful commands: \texttt{rename()}, \texttt{select()}, \texttt{filter()}].

- Load and clean the data on GDP per capita as \texttt{gdppc} (remove missing values, rename variables to meaningful and managable names, select the relevant variables). [Useful commands: \texttt{rename()}, \texttt{select()}, \texttt{filter()}].

- Combine the two datasets by matching on \texttt{year} and \texttt{country}. [Useful commands: \verb|df <- life_sat %>% full_join(gdppc, by = c("country", "year"))|].  

- Construct the plot below. [Useful commands: \texttt{ggplot()}, \texttt{geom\_point()}, \texttt{shape = as.factor(year)}, \verb|scale_shape_manual(values=c(0,3,1))|].

- Export to a word file and comment on the plot.

```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, fig_caption= FALSE,fig.align="center", include=FALSE}
library(tidyverse)
library(readr)

## Loading and cleaning the data on life satisfaction  
life_sat <- read_csv("~/Dropbox/economic_data/labs/lab_5/ilc_pw01__custom_7985898_linear.csv") %>% 
  select(geo, TIME_PERIOD, OBS_VALUE) %>% 
  rename(country  = geo,
         year     = TIME_PERIOD, 
         life_sat = OBS_VALUE)


## Loading and cleaning the data on GDP per capita   
gdppc <- read_csv("~/Dropbox/economic_data/labs/lab_5/sdg_08_10__custom_7985512_linear.csv") %>% 
  select(geo, TIME_PERIOD, OBS_VALUE) %>% 
  rename(country = geo,
         year    = TIME_PERIOD, 
         gdppc   = OBS_VALUE)


## Combining the datasets 
df <- life_sat %>% 
  full_join(gdppc, by = c('country', 'year')) %>% 
  filter(!is.na(life_sat), !is.na(gdppc), country!='EU27_2020') 


## Plotting the data 
p1 <- ggplot(data=df, aes(x = gdppc, y = life_sat, shape = as.factor(year)))+
  geom_point(size = 1.3)+
  scale_shape_manual(values=c(0,3,1))+
  theme(plot.title = element_text(size=12),
        plot.subtitle = element_text(size=9),
        legend.title = element_blank(),
        legend.position="bottom",
        plot.caption = element_text(size=6, hjust = 0),
        axis.title = element_text(size = 11),
        strip.background = element_blank(),
        strip.placement = "outside",
        panel.grid.minor = element_line('grey', size = 0.1, linetype = 'dashed'),
        panel.grid.major = element_line('grey', size = 0.1, linetype = 'dashed'),
        legend.key = element_rect(fill = NA),
        text=element_text(family="Palatino"),
        panel.background = element_rect(fill = "transparent", colour = NA),
        plot.background = element_rect(fill = "transparent", colour = NA))+
  xlab("Real GDP per capita") +
  ylab("Life satisfaction (1=lowest, 10=highest)") +
  labs(title = "Life satisfaction vs. GDP per capita",
       size = 'Population:',
       color = ' ',
       subtitle = "GDP per capita is measured in 2010 prices",
       caption = "Source: Eurostat (2023). Note: Chain linked volumes (2010), euro per capita.")
  
```

```{r dev.args = list(bg = 'transparent'), fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, fig_caption= FALSE, fig.height = 3.7, fig.width = 4.8, fig.align="center"}
p1
```



# Part 2

In this exercise we will create our own development index (a summary of GDP per capita and life expectancy) and plot the evolution of this index for several countries since 1990. For this exercise, the R script \texttt{odi.R} in Blackboard is useful. Also read Chapter 5.6 in the textbook (available [here](https://hhsievertsen.github.io/EconDataBook/wellbeing.html)).

- Open an R script and save it on your computer as \verb|dev_index.R|.

- Go to https://data.worldbank.org/ and download data on expectancy at birth total (not by gender) for 1990 to 2020 for your country and at least 20 other countries. Download the data in csv format.

- Also download data on GDP per capita in constant prices and in an internationally comparable unit for 1990 to 2020 for the same countries as the life expectation data. Download the data in csv format. Section 10.3 in Introduction to Economic Data might be useful for exercise. 

- Combine the datasets. 

- Construct a new variable in your dataset called \texttt{lei} given by the formula $\text{lei} = \frac{\text{life expect.} - 20}{85-20}$. 

- Construct a new variable in your dataset called \texttt{ii} given by the formula $\text{ii} = \frac{log(\text{GDP per capita}) - log(100)}{log(75000) - log(100)}$. 

- Construct a new variable in your dataset called \texttt{odi} given by the formula $\text{odi} = \sqrt{lei \times ii}$. 

- Construct a new variable in your dataset that takes the value one if the country is your country and zero otherwise. 

- Try to create the chart and the Table shown in the figure below. 

- You can use the charts in your mini project 2. But remember you can only include two visualisations in total (i.e., one chart and one table, two tables or two charts).



```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, fig_caption= FALSE,fig.align="center", include=FALSE}
library(tidyverse)
library(readr)


countries <- c("United Kingdom", 
               "United States",
               "Austria", 
               "Australia",
               "Belgium",
               "Switzerland",
               "Denmark",
               "Spain",
               "France",
               "Greece",
               "Italy",
               "Japan",
               "Netherlands",
               "Norway",
               "New Zealand",
               "Poland",
               "Portugal",
               "Slovak Republic",
               "Sweden")


## Life expectancy
life_exp <- read_csv("~/Dropbox/economic_data/labs/lab_5/wb/API_SP.DYN.LE00.IN_DS2_en_csv_v2_5871609.csv", skip = 4) %>% 
  select(-"Indicator Name", -"Indicator Code") %>% 
  rename(country = "Country Name",
         ccode = "Country Code") %>% 
  gather(year, life_exp, 3:66) %>% 
  filter(year>=1990, year<=2020) %>% 
  filter(country %in% countries)%>% 
  mutate(life_exp = as.numeric(life_exp))
  

## GDP per capita ppp in constant prices
gdppc <- read_csv("~/Dropbox/economic_data/labs/lab_5/wb/API_NY.GDP.PCAP.PP.KD_DS2_en_csv_v2_5873868.csv", skip = 4) %>% 
  select(-"Indicator Name", -"Indicator Code") %>% 
  rename(country = "Country Name",
         ccode = "Country Code") %>% 
  gather(year, gdppc, 3:66) %>% 
  filter(year>=1990, year<=2020) %>% 
  filter(country %in% countries) %>% 
  mutate(gdppc = as.numeric(gdppc))


## Combining the datasets
df <- life_exp %>% 
  full_join(gdppc, by = c('country', 'ccode', 'year')) %>% 
  mutate(lei = (life_exp - 20)/(85-20),
         ii  = (log(gdppc) - log(100))/(log(75000) - log(100)),
         odi = (lei * ii)^0.5) %>% 
  mutate(uk = ifelse(country == 'United Kingdom', 1, 0) %>% as.factor())



## Plotting the data 
p1 <- ggplot(data = df, aes(x = as.numeric(year), y = odi, color = country))+
  geom_line(aes(alpha = uk))+
  scale_color_manual(values = rep(1, 19))+
  scale_alpha_manual(values = c(0.1, 1))+
  theme(plot.title = element_text(size=12),
        plot.subtitle = element_text(size=9),
        legend.title = element_blank(),
        legend.position="none",
        plot.caption = element_text(size=6, hjust = 0),
        axis.title = element_text(size = 11),
        strip.background = element_blank(),
        strip.placement = "outside",
        panel.grid.minor = element_line('grey', size = 0.1, linetype = 'dashed'),
        panel.grid.major = element_line('grey', size = 0.1, linetype = 'dashed'),
        legend.key = element_rect(fill = NA),
        text=element_text(family="Palatino"),
        panel.background = element_rect(fill = "transparent", colour = NA),
        plot.background = element_rect(fill = "transparent", colour = NA))+
  xlab("Year") +
  ylab("Our development index (ODI)") +
  labs(title = "Our development index by country, 1990-2020",
       subtitle = "index created from life expectancy at birth and real GDP per capita (PPP)",
       caption = "Source: World Bank. Note: ODI is a weighted average of GDP per capita PPP in 2017 constant prices and \n life expectancy at birth.")


```

```{r dev.args = list(bg = 'transparent'), fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, fig_caption= FALSE, fig.height = 3.7, fig.width = 4.8, fig.align="center"}
p1
```


