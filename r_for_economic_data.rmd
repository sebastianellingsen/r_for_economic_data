---
title: "R for Economic Data Labs"
author: "Sebastian Ellingsen"
date: "1/11/2023"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{css, eval = TRUE, echo = FALSE}
.remark-code{line-height: 1.5; font-size: 80%}

@media print {
  .has-continuation {
    display: block;
  }
}

code.r.hljs.remark-code{
  position: relative;
  overflow-x: hidden;
}


code.r.hljs.remark-code:hover{
  overflow-x:visible;
  width: 500px;
  border-style: solid;
}
```


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)

# This is the recommended set up for flipbooks
# you might think about setting cache to TRUE as you gain practice --- building flipbooks from scratch can be time consuming
knitr::opts_chunk$set(fig.width = 6, fig.retina = 5,message = FALSE, warning = FALSE, comment = "", cache = F)
library(flipbookr)
library(tidyverse)
library(readxl)

```

# R for Economic Data Labs


This is a document that collects the commands we have used in R so far in the course. 

--

As the course progresses we will extend this list. 

--

It also presents a walk through of the R scripts from all the labs so far.

---



# Style guide

To make the scripts understandable for other people and for yourself in the future, it is important to follow a few principles when writing code.

- Add comments in scripts. This is done with a $\texttt{#}$. R will ignore anything that comes after a $\texttt{#}$.

- Names should be descriptive and meaningful. 

- Use underscore to separate words in a variable name of several words, not spaces.

- Add line breaks and avoid very long lines. 

- Variable and function names should be written in lowercase. 

- Avoid using names that are the same as existing variables.

- Add spacing between symbols such as $\texttt{+}$, $\texttt{=}$, and $\texttt{-}$.

- Verically align some repetitive coding tasks.


---



# Libraries in R

- To install a library in R use $\texttt{install.packages("library name")}$. This typically only needs to be done once during this course. To update the library, you can use the same command.

- To load a library in R use $\texttt{library(library name)}$. This needs to be done every time you load commands from a library.

- It is good practice to only load the packages you need for each session. The reason is that some packages have the same function names. In this case, you need to specify from which package the function is from. This is done with $\texttt{library name::function name}$.

- $\texttt{readr}$ has functionality for importing standard data formats in a convenient way. 

- $\texttt{readxl}$ has functions for importing data stored in Excel.

- $\texttt{tidyverse}$ has several functions that are convenient for working with data.

---




# General functions

- $\texttt{%>%}$ is a function from the $\texttt{tidyverse}$ package. It tells R that we are referring to an object we have defined on a line above.

- $\texttt{<-}$ is an assignment operator in R. You can assign an object to a name. For example, if you want to create a variable $\texttt{x}$ that takes the value $3$, you can write $\texttt{x <- 3}$. From our labs, we have seen how we can assign a plot or a dataset to a variable name as well. 

- Addition: $\texttt{+}$, subtraction: $\texttt{-}$, multiplication: $\texttt{*}$, division: $\texttt{/}$.

- Vectors are constructed using $\texttt{c()}$ (for concatenate). Ex: $\texttt{v <- c(1,2,3)}$.

- $\texttt{ifelse(statement, if true, if false)}$ creates an indicator variable.


---



# Cleaning data

- $\texttt{read_csv()}$ opens csv files in R.

- $\texttt{read_excel()}$ opens excel files in R. 

- $\texttt{select()}$ selects columns in a dataset.

- $\texttt{filter()}$ selects rows in a dataset.

- $\texttt{rename()}$ renames columns in a dataset.

- $\texttt{mutate()}$ create a new column in a dataset.

- $\texttt{lag( ,n = 1)}$ lags a variable $\texttt{n}$ rows.


---






# Plotting data 

- $\texttt{ggplot()}$ is a command for plotting data.

- $\texttt{geom_line()}$ connects a line between your data points.

- $\texttt{geom_point()}$ plots the data points.

- $\texttt{geom_bar()}$ plots a bar chart.














---
class: inverse, middle, center



# Computer Lab 3





---


```{r, include = F}
# This is the recommended set up for flipbooks
# you might think about setting cache to TRUE as you gain practice --- building flipbooks from scratch can be time consuming
## Loading packages 
library(readr)
library(tidyverse)
library(ggrepel)

## Loading and cleaning data 
df <- read_csv('life-expectancy-vs-gdp-per-capita.csv') %>% 
  rename(year      = Year) %>% 
  rename(country   = Entity) %>% 
  rename(code      = Code) %>% 
  rename(gdppc     = `GDP per capita`) %>% 
  rename(life_exp  = `Life expectancy at birth (historical)`) %>% 
  rename(pop       = `Population (historical estimates)`) %>% 
  rename(continent = Continent) %>% 
  select(country, continent, year, gdppc, life_exp, pop) %>% 
  filter(year == 2015) %>%  
  filter(!is.na(pop)) %>% 
  filter(!is.na(gdppc)) 
```


`r chunk_reveal("chunk_5")`

```{r chunk_5, include = FALSE}
## Loading packages 
library(readr)
library(tidyverse)
library(ggrepel)

## Loading and cleaning data 
read_csv('life-expectancy-vs-gdp-per-capita.csv') %>% 
  rename(year      = Year) %>% 
  rename(country   = Entity) %>% 
  rename(code      = Code) %>% 
  rename(gdppc     = `GDP per capita`) %>% 
  rename(life_exp  = `Life expectancy at birth (historical)`) %>% 
  rename(pop       = `Population (historical estimates)`) %>% 
  rename(continent = Continent) %>% 
  select(country, continent, year, gdppc, life_exp, pop) %>% 
  filter(year == 2015) %>%  
  filter(!is.na(pop)) %>% 
  filter(!is.na(gdppc)) 
```




---




`r chunk_reveal("chunk_6")`

```{r chunk_6, include = FALSE}
## Plotting the data 
ggplot(data = df, aes(x = log(gdppc), y = life_exp, color = continent))+#
  geom_point(aes(size = pop), alpha = 0.6, stroke = 0.2)+
  scale_size_continuous(range = c(0.5, 8),  breaks = c(6e+8, 1.3e+9), labels = c('600M', '1.3B'))+
    xlab("GDP per capita (log)") +
  ylab("Life expectancy at birth") +
  labs(title = "Life expectancy vs. GDP per capita, 2015",
       size = 'Population:',
       color = ' ',
       subtitle = "GDP per capita is adjusted for inflation and differences in the cost of living between countries.",
       caption = "Source: UN WPP (2022); Zijdeman et al. (2015); Riley (2005); Maddison Project Database 2020 (Bolt and van Zanden, 2020).\nNote: GDP per capita is expressed in international-dollars at 2011 prices.")+
  theme(plot.title = element_text(size=12))+
        theme(plot.subtitle = element_text(size=9))+
        theme(legend.title = element_text(size=9))+
        theme(plot.caption = element_text(size=6, hjust = 0))+
        theme(axis.title = element_text(size = 11))+
        theme(strip.background = element_blank())+
        theme(strip.placement = "outside")+
        theme(panel.grid.minor = element_line('grey', size = 0.1, linetype = 'dashed'))+
        theme(panel.grid.major = element_line('grey', size = 0.1, linetype = 'dashed'))+
        theme(legend.key = element_rect(fill = NA))+
        theme(text=element_text(family="Palatino"))+
        theme(panel.background = element_rect(fill = "transparent", colour = NA))+
        theme(plot.background = element_rect(fill = "transparent", colour = NA))+
  scale_x_continuous(n.breaks=8) +
  scale_y_continuous(n.breaks=8) +
  geom_text_repel(aes(label=ifelse(country %in% c('China','Democratic Republic of Congo', 'South Africa', 'Indonesia',  'Equatorial Guinea', 'Trinidad and Tobago', 'Italy', 'Poland', 'Brazil', 'Italy', 'Poland', 'Angola', 'Nigeria', 'United States',  'North Korea', 'Ethiopia',  'Chad', 'India', 'Pakistan'), country, '')),size = 3, show.legend  = FALSE) +
  guides(size = guide_legend(override.aes=list(shape = 1)),
         color = guide_legend(override.aes=list(shape = 15)))
```








