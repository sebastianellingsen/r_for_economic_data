---
title: |
  | \vspace{0.3cm} \Huge \singlespacing \textbf{Economic Data 2023 - Labs}  \vspace{0.28cm}
  | \vspace{0.3cm} \large Week 4 \vspace{0.3cm}
indent: true
output:
  pdf_document:
    number_sections: true
    fig_caption: true
    citation_package: natbib 
    # keep_tex: true
citecolor: blue
linkcolor: blue
bibliography: library.bib
biblio-style: apsr
link-citations: true
fontsize: 11pt
# geometry: margin=3cm
# geometry: margin=2.4cm
geometry: margin=2.45cm
# fontsize: medium
linestretch: 2.5
header-includes:
   - \usepackage{setspace}\setstretch{2.9}
   - \usepackage{caption}
   - \captionsetup[figure]{font=small}
   - \usepackage[font={scriptsize,it}, labelfont={bf}]{caption}
   - \usepackage{threeparttable}
   - \usepackage{booktabs}
   - \usepackage{mathtools}
   - \pagenumbering{gobble}
   - \usepackage{setspace}
   - \usepackage{amsmath}
   - \usepackage{lmodern}
   - \usepackage{bbm}
   - \usepackage{lscape}
   - \newcommand{\blandscape}{\begin{landscape}}
   - \newcommand{\elandscape}{\end{landscape}}
   - \usepackage{boldline}
   - \usepackage{pdfpages}
   - \usepackage{color}
   - \usepackage{xcolor}
   - \colorlet{Blue}{blue}
   - \usepackage{enumitem}
   - \usepackage{romannum}
   - \usepackage{siunitx}
   - \usepackage{gensymb}
   - \usepackage[osf]{mathpazo}
   - \usepackage{graphicx}
   - \newcommand{\indep}{\rotatebox[origin=c]{90}{$\models$}}
   - \newtheorem{theorem}{Definition}
   - \usepackage{indentfirst}
   - \usepackage{pgf,tikz}
   - \usetikzlibrary{shapes}
   - \usepackage{bm}
   - \usepackage{dirtytalk}
   - \setlength{\bibsep}{3pt}
editor_options:
  chunk_output_type: console
---

\onehalfspacing
\pagenumbering{arabic}




\noindent Your country depends on the timing of your lab session:

- Group 1: Tuesday 10:00 to 12:00: Slovenia

- Group 2: Wednesday 9:00 to 11:00: Greece

- Group 4: Wednesday 11:00 to 13:00: Finland

- Group 3: Thursday 9:00 to 11:00: Spain





# Part 1

\noindent In this part we will use the dataset \texttt{birth.csv} which is available on Blackboard to work with fertility rates. The definitions of the age-specific fertility rate and the total fertility rate can be found in chapter 2 of our textbook (available [here](https://hhsievertsen.github.io/EconDataBook/po.html)).

- Open an R script and save it on your computer as \verb|fertility_rates.R|. Load the libraries \texttt{tidyverse} and \texttt{readr}.

- Load the dataset \verb|births.csv| in R and store it in an object called \texttt{df}. 

- Clean the dataset in your script. Columns should have names that are easy to work with (no capital letters, no spaces, and descriptive names). [Useful commands: \texttt{rename()}, \texttt{filter()}].

- Generate a new variable \texttt{afr} that gives the age-specific fertility rate. [Useful commands: \texttt{mutate(afr = n\_births/n\_women)}].

- Plot the age-specific fertility rate. [Useful commands: \texttt{ggplot()}].

- Calculate the total fertility rate. [Useful commands: \texttt{sum(df\$afr, na.rm=T)}].

- Export the plot and put it into a Word file. Comment on your findings.










# Part 2

\noindent In this exercise we will calculate the growth rate of GDP per capita for your country since 1980. We are often more interested in changes than in levels of GDP per capita. Getting from the level of GDP to the growth rate is straightforward, given that the levels are measured in real terms. We can use the following formula to calculate the growth rate in percent:
\begin{equation}
g_t = 100 \times \left(\frac{\text{GDP}_t}{\text{GDP}_{t-1}}-1\right),
\end{equation}
where $t$ refers to the current period and $t-1$ the previous period. You can read more about growth rates [here](https://hhsievertsen.github.io/EconDataBook/activity.html). For this exercise, go through the following steps.




- Open an R script and save it on your computer as \verb|growth_rates.R|. Load the libraries \texttt{tidyverse} and \texttt{readxl}.

- Load the Madison dataset we used in week 2 (available [here](https://www.rug.nl/ggdc/historicaldevelopment/maddison/releases/maddison-project-database-2020?lang=en)). 

- Clean the dataset using the code you wrote in Lab 2 (removing unnecessary columns, renaming columns). 

- Keep only observations after 1980.

- Construct a variable named \texttt{gdppc\_1} that for each year gives the GDP per capita in the previous year. [Useful commands: \texttt{mutate()}, \texttt{lag(gdppc, n = 1)}].

- Construct a variable named \texttt{gdppc\_g} that gives the growth rate in GDP per capita for each year using the above formula. [Useful commands: \texttt{mutate()}].

- Construct a variable named \texttt{positive} that takes the value 1 if the GDP per capita growth rate is positive and zero otherwise. [Useful commands: \texttt{mutate()}, \texttt{ifelse(gdppc\_g>0, 1, 0)}].

- Export this new version of the dataset as \texttt{growth\_rates.csv} [Useful commands: \texttt{write\_csv()}].

- Finally, open \verb|growth_rates_plot.R| which is available on Blackboard, and paste it into the bottom of your script \verb|growth_rates.R|. Then run the entire file. Export the plot and put it into a Word file. Comment on your findings.

\bigskip 



```{r, fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, fig_caption= FALSE,fig.align="center", include=FALSE}
library(tidyverse)
library(readxl)

mpd2020 <- read_excel('~/Dropbox/economic_data/labs/lab_1/mpd2020.xlsx', 
                      sheet = 4, skip = 1) %>% 
  dplyr::select(year, GBR) %>% 
  filter(year >= 1979) %>% 
  rename(gdppc = GBR) %>% 
  mutate(gdppc_1 = lag(gdppc, n = 1)) %>% 
  mutate(gdppc_g = (gdppc/gdppc_1 - 1)*100) %>% 
  filter(year>=1980) %>% 
  mutate(positive = ifelse(gdppc_g>0, 1, 0) %>% as.factor())



## Plotting the growth rates
p1 <- ggplot(data = mpd2020, aes(x = year, y = gdppc_g, fill = positive))+
  geom_bar(stat='identity') +
  theme(plot.title = element_text(size=12),
        plot.subtitle = element_text(size=9),
        legend.title = element_text(size=9),
        plot.caption = element_text(size=6, hjust = 0),
        axis.title = element_text(size = 11),
        strip.background = element_blank(),
        strip.placement = "outside",
        panel.grid.minor = element_line('grey', size = 0.1, linetype = 'dashed'),
        panel.grid.major = element_line('grey', size = 0.1, linetype = 'dashed'),
        legend.key = element_rect(fill = NA),
        legend.position = "none",
        text=element_text(family="Palatino"),
        panel.background = element_rect(fill = "transparent", colour = NA),
        plot.background = element_rect(fill = "transparent", colour = NA))+
  xlab("Year") +
  ylab("Growth rate") +
  # xlim(1980, 2018) +
  labs(title = "The growth rate of GDP per capita for the UK, 1980-2018",
       color = ' ',
       subtitle = "Real GDP per capita in 2011 dollars.",
       caption = "Source: Maddison Project Database (MPD) 2020")
```

```{r dev.args = list(bg = 'transparent'), fig.align="center", echo=FALSE, message=FALSE, warning=FALSE, fig_caption= FALSE, fig.height = 3.7, fig.width = 6.8, fig.align="center"}
p1
```


<!-- \centering -->
<!-- ![](growth){width=60%} -->









